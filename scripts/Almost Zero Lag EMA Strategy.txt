//@version=4
strategy("Almost Zero Lag EMA Strategy [LazyBear]", shorttitle="ZLEMA_Strategy_LB", overlay=true)

length = input(10)
exit_bars = input(10, "Exit After N Bars", minval=1)
src = close

ema1 = ema(src, length)
ema2 = ema(ema1, length)
d = ema1 - ema2
zlema = ema1 + d

plot(zlema, color=color.orange, linewidth=2, title="ZLEMA")

// Entry Conditions
long_condition = crossover(close, zlema)
short_condition = crossunder(close, zlema)

// Track bar index for timed exit
var int long_entry_bar = na
var int short_entry_bar = na

if (long_condition)
    strategy.entry("Long", strategy.long)
    strategy.exit("TP/SL Long", from_entry="Long", limit=close * (1 + {{TP}} / 100), stop=close * (1 - {{SL}} / 100))
    long_entry_bar := bar_index

if (short_condition)
    strategy.entry("Short", strategy.short)
    strategy.exit("TP/SL Short", from_entry="Short", limit=close * (1 - {{TP}} / 100), stop=close * (1 + {{SL}} / 100))
    short_entry_bar := bar_index

// Exit after N bars
if (strategy.position_size > 0 and not na(long_entry_bar) and bar_index - long_entry_bar >= exit_bars)
    strategy.close("Long")
    long_entry_bar := na

if (strategy.position_size < 0 and not na(short_entry_bar) and bar_index - short_entry_bar >= exit_bars)
    strategy.close("Short")
    short_entry_bar := na
